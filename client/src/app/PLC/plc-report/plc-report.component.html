<div class="sticky-div">
  <tabset class="member-tabset">
    <tab heading="Upload Files">
      <app-file-manager [fileVersion]="fileVersion"></app-file-manager>
    </tab>
    <tab heading="Prescriptions">
      <div>
        <label for="noYear">Number of Projections</label>&nbsp;
        <mat-form-field>
          <input
            matInput
            [(ngModel)]="noYear"
            (ngModelChange)="changeColumns()"
          />
        </mat-form-field>
        &nbsp;&nbsp;
        <label for="startYear">Starting Year</label> &nbsp;
        <mat-form-field>
          <input
            matInput
            maxlength="4"
            [(ngModel)]="startYear"
            (ngModelChange)="changeColumns()"
          />
        </mat-form-field>
        &nbsp;&nbsp;
        <label for="decrease">Projected volume with a decrease of</label>&nbsp;
        <mat-form-field>
          <input
            matInput
            [(ngModel)]="decrease"
            ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/"
            step="0.00"
            (ngModelChange)="changeColumns()"
          />
        </mat-form-field>
      </div>
      <table class="table table-condensed">
        <thead>
          <tr>
            <th *ngFor="let item of AvgYears">{{ item }}</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4 || idx == 0"
                [(ngModel)]="MonthPresc[0][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[1][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[2][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[3][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[4][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[5][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[6][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[7][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[8][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[9][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[10][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td
              *ngFor="let item of AvgYears; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 5 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                [disabled]="idx > 4"
                [(ngModel)]="MonthPresc[11][idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of AvgYears; index as idx">
              <strong>{{
                idx === 0 ? "Total Items" : getTotalItems(idx)
              }}</strong>
            </td>
          </tr>
        </tbody>
      </table>
      <hr />
      <table class="table table-condensed">
        <thead>
          <tr>
            <th *ngFor="let item of Years | slice: 0:3; let i = index">
              {{ item }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td
              *ngFor="let item of Years; index as idx"
              [ngStyle]="{
                'background-color':
                  idx !== 0 && idx < 3 ? 'rgb(254,242,203)' : 'white'
              }"
            >
              <input
                matInput
                *ngIf="idx !== 0 || idx < 3"
                [(ngModel)]="mur[idx]"
                value="0"
              />
            </td>
          </tr>
        </tbody>
      </table>
      <hr />
    </tab>
    <tab heading="Sales">
      <div>
        <label for="noYear">Number of Year Projections</label>&nbsp;
        <mat-form-field>
          <input
            matInput
            [(ngModel)]="noYear"
            (ngModelChange)="changeColumns()"
          />
        </mat-form-field>
        &nbsp;&nbsp;
        <label for="startYear">Starting Year</label> &nbsp;
        <mat-form-field>
          <input
            matInput
            [(ngModel)]="startYear"
            (ngModelChange)="changeColumns()"
          />
        </mat-form-field>
      </div>
      <table class="table table-condensed">
        <thead>
          <tr>
            <th *ngFor="let item of Years">{{ item }}</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="zeroOTCSale[idx]"
                (ngModelChange)="cpZeroOTCSale(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="vatOTCSale[idx]"
                (ngModelChange)="cpVatOTCSale(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <strong>{{
                idx === 0
                  ? "Total OTC Sales"
                  : (getTotalOTC(idx) | currency: "GBP")
              }}</strong>
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              {{
                idx === 0
                  ? "NHS Sales Reimbursement (net)"
                  : getNHSSalesReimburse(idx)
              }}
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              {{ idx === 0 ? "SAF" : getSAF(idx) }}
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              {{
                idx === 0
                  ? "Establishment Payment"
                  : idx < 3
                  ? getEstablishedPay(idx)
                  : ""
              }}
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="nhsother[idx]"
                (ngModelChange)="cpNhsOther(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <strong>{{
                idx === 0
                  ? "Subtotal (Ess. Services)"
                  : (getSubtotalNHS(idx) | currency: "GBP")
              }}</strong>
            </td>
          </tr>
          <tr
            [ngStyle]="{
              'background-color': 'rgb(217,226,243)'
            }"
          >
            <td *ngFor="let item of Years; index as idx">
              {{
                idx === 0
                  ? "As % of gross profit"
                  : (getSubtotalNHS(idx) / getGross(idx) | percent)
              }}
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="nms[idx]"
                (ngModelChange)="cpNms(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              {{ idx === 0 ? "MUR" : idx < 3 ? getMUR(idx) : "" }}
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx == 0"
                [(ngModel)]="transitionpay[idx]"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="advother[idx]"
                (ngModelChange)="cpAdvOther(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <strong>{{
                idx === 0
                  ? "Subtotal (Adv. Services)"
                  : (getSubtotalAdv(idx) | currency: "GBP")
              }}</strong>
            </td>
          </tr>
          <tr
            [ngStyle]="{
              'background-color': 'rgb(217,226,243)'
            }"
          >
            <td *ngFor="let item of Years; index as idx">
              {{
                idx === 0
                  ? "As % of gross profit"
                  : (getSubtotalAdv(idx) / getGross(idx) | percent)
              }}
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="nhsenhancedserv[idx]"
                (ngModelChange)="cpNHSenhancedServ(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="nhsundries[idx]"
                (ngModelChange)="cpNHSundries(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="qualitypay[idx]"
                (ngModelChange)="cpQualityPay(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="pharmacyaccscheme[idx]"
                (ngModelChange)="cpPharmacy(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="buyingprofit[idx]"
                (ngModelChange)="cpBuyingProfit(idx)"
                value="0"
              />
            </td>
          </tr>
          <tr
            [ngStyle]="{
              'background-color': 'rgb(217,226,243)'
            }"
          >
            <td *ngFor="let item of Years; index as idx">
              {{
                idx === 0
                  ? "As % of gross profit"
                  : (buyingprofit[idx] / getGross(idx) | percent)
              }}
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <strong>{{
                idx === 0
                  ? "Total NHS Sales"
                  : (getNHSSales(idx) | currency: "GBP")
              }}</strong>
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <strong>{{
                idx === 0
                  ? "Grand total sales / Turnover (£)"
                  : (getGrandTotalNHS(idx) | currency: "GBP")
              }}</strong>
            </td>
          </tr>
        </tbody>
      </table>
    </tab>
    <tab heading="Gross Profit">
      <div>
        <label for="noYear">Number of Year Projections</label>&nbsp;
        <mat-form-field>
          <input
            matInput
            [(ngModel)]="noYear"
            (ngModelChange)="changeColumns()"
          />
        </mat-form-field>
        &nbsp;&nbsp;
        <label for="startYear">Starting Year</label> &nbsp;
        <mat-form-field>
          <input
            matInput
            [(ngModel)]="startYear"
            (ngModelChange)="changeColumns()"
          />
        </mat-form-field>
      </div>
      <table class="table table-condensed">
        <thead>
          <tr>
            <th *ngFor="let item of Years">{{ item }}</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="YearVal[0][idx]"
                (ngModelChange)="copyData(0, idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <input
                matInput
                [disabled]="idx > 2 || idx == 0"
                [(ngModel)]="YearVal[1][idx]"
                (ngModelChange)="copyData(1, idx)"
                value="0"
              />
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <strong>{{
                idx === 0 ? "Total cost of sales" : getTotal(idx)
              }}</strong>
            </td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx"></td>
          </tr>
          <tr>
            <td *ngFor="let item of Years; index as idx">
              <strong>{{
                idx === 0
                  ? "Gross Profit (£)"
                  : (getGross(idx) | currency: "GBP")
              }}</strong>
            </td>
          </tr>
        </tbody>
      </table>
    </tab>
    <tab heading="Expenses">
      <div class="container">
        <h2>Please add your manual inputs here</h2>
        <div
          *ngFor="
            let entry of EntriesArray.controls;
            last as isLast;
            index as idx
          "
          class="input-row"
        >
          <mat-form-field>
            <input
              matInput
              [formControl]="LabelsArray.controls[idx]"
              placeholder="label"
            />
          </mat-form-field>
          &nbsp;:&nbsp;&nbsp;&nbsp;
          <mat-form-field>
            <input
              matInput
              [formControl]="entry"
              (ngModelChange)="saveExpense(1)"
              placeholder="input data "
            />
          </mat-form-field>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <mat-form-field>
            <input
              matInput
              [formControl]="Entries2Array.controls[idx]"
              (ngModelChange)="saveExpense(2)"
              placeholder="input data"
            />
          </mat-form-field>
          <button
            mat-icon-button
            color="warn"
            (click)="removeInputControl(idx)"
            *ngIf="EntriesArray.length > 1"
          >
            <mat-icon>remove_circle</mat-icon>
          </button>
          <button
            mat-icon-button
            color="primary"
            *ngIf="isLast"
            (click)="addInputControl()"
          >
            <mat-icon>add_circle</mat-icon>
          </button>
        </div>
        <table class="table table-condensed">
          <tbody>
            <tr>
              <td *ngFor="let item of Years; index as idx">
                {{
                  idx === 0
                    ? "Total Expense"
                    : Expense[idx] === undefined
                    ? (0 | currency: "GBP")
                    : (Expense[idx] | currency: "GBP")
                }}
              </td>
            </tr>
            <tr
              [ngStyle]="{
                'background-color': 'rgb(217,226,243)'
              }"
            >
              <td *ngFor="let item of Years; index as idx">
                {{
                  idx === 0
                    ? "As % of gross profit"
                    : (Expense[idx] / getGross(idx) | percent)
                }}
              </td>
            </tr>
            <tr>
              <td *ngFor="let item of Years; index as idx">
                <strong>{{
                  idx === 0
                    ? "Profit/Loss"
                    : (getProfitLoss(idx) | currency: "GBP")
                }}</strong>
              </td>
            </tr>
            <tr
              [ngStyle]="{
                'background-color': 'rgb(217,226,243)'
              }"
            >
              <td *ngFor="let item of Years; index as idx">
                <strong>{{
                  idx === 0
                    ? "As % of gross profit"
                    : (getProfitLoss(idx) / getGross(idx) | percent)
                }}</strong>
              </td>
            </tr>
          </tbody>
        </table>
        <button
          class="btn btn-success mr-2"
          (click)="saveExpense(1)"
          type="submit"
        >
          Save Data
        </button>
      </div>
    </tab>
    <tab heading="Inflation"> </tab>
  </tabset>
</div>
